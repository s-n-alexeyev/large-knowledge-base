2024-12-30

Настройка Tailscale на OpenWrt предполагает установку клиента Tailscale, настройку ключей и включение Tailscale в качестве VPN. Вот пошаговая инструкция:

# 1. Подготовка маршрутизатора OpenWrt

>Обновление пакетов текущей версии:
```bash
opkg update && opkg list-upgradable| awk '{print $1}'| tr '\n' ' '| xargs -r opkg upgrade
```

# 2. Установка пакета Tailscale и зависимостей

Tailscale доступен в репозиториях OpenWrt начиная с версии 21.02. Чтобы установить его:

>Обновление списокf пакетов:
```bash
opkg update
```

>Установка Tailscale:
```bash
opkg install tailscale
```

>Если ваш маршрутизатор использует нестандартную архитектуру, можно вручную скачать пакет Tailscale с официального сайта OpenWrt и установить его:
```bash
opkg install /путь/к/скачанному/пакету.ipk
```

>Установка зависимостей:
```bash
opkg install iptables ip6tables kmod-ipt-nat kmod-nf-conntrack
```

# 3. Запуск и авторизация Tailscale

>Запустите Tailscale:
```bash
/etc/init.d/tailscale start
```

>Авторизация устройства в сети Tailscale:
```bash
tailscale up
```

Скопируйте ссылку, выданную командой, и откройте её в браузере. Войдите в свой аккаунт Tailscale, чтобы завершить авторизацию.

# 4. Настройка автозапуска

Чтобы Tailscale запускался автоматически после перезагрузки, выполните:

```bash
/etc/init.d/tailscale enable
```

# 5. Проверка подключения

После авторизации проверьте состояние Tailscale:

```bash
tailscale status
```

Вы должны увидеть подключенные устройства и IP-адреса Tailscale.
# 6. Настройка маршрутизации (опционально)

Если вы хотите использовать маршрутизатор как выходной узел для других устройств в сети Tailscale:

>Включение маршрутизации:
```bash
tailscale up --advertise-routes=192.168.1.0/24
```

Здесь 192.168.1.0/24 — это подсеть вашей локальной сети.

>Убеждаемся, что маршрутизатор может пересылать трафик. Проверьте файл `/etc/sysctl.conf`, чтобы параметр был включен:
```
net.ipv4.ip_forward=1
```

>Применение изменений:
```bash
sysctl -p
```

# 7. Диагностика и устранение неполадок

Если Tailscale не запускается, проверьте логи:

```bash
logread | grep tailscale
```

Убедитесь, что порты UDP 41641 и 3478 не блокируются вашим файрволом.


