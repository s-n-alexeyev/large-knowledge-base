2023-11-24  
[Источник](https://help.inbuh.kz/6737/)

В информационной системе электронных счетов-фактур (ИС ЭСФ) в связи с переходом на новый криптографический стандарт ГОСТ 2015, с 26 ноября 2023 года, текущий метод аутентификации для пользователей с новыми ключами формата ГОСТ 2015 (единый ключ для подписи и аутентификации) будет не доступен. Для пользователей с ключами старого формата ГОСТ 2004 (AUTH — для аутентификации, RSA/GOSTKNCA — для подписи) текущий метод аутентификации будет доступен до истечения срока действия ключей.

В связи с предстоящими изменениями политики безопасности системы ИС ЭСФ, в конфигурации добавлена новая настройка Использовать внешнюю криптографию (Kalkan) для компоненты для использования в качестве криптографии библиотеки KalkanCrypt. Данная настройка позволяет:  
 поддерживать новый метод аутентификации при использовании прямого обмена документами с ИС ЭСФ;  
 работать с ключами формата ГОСТ 2015;  
 использовать режим криптографических операций На сервере 1С:Предприятие в случае работы базы в клиент-серверном варианте.  
Настройка доступна в разделе Администрирование – Общие настройки – Настройка электронных счетов-фактур (вкладка Криптографическая библиотека). Внимание! Библиотека KalkanCrypt не входит в поставку типового решения. Это связано с тем, что ее публикация и тиражирование запрещены владельцем. Библиотека предоставляется НУЦ РК пользователю/организации пользователя в составе комплекта разработчика НУЦ РК, в соответствии с регламентом, опубликованным на портале НУЦ РК https://pki.gov.kz/developers/.  
Для применения библиотеки в учетной системе необходимо:

1. Разместить библиотеку KalkanCrypt.dll (находится в каталоге KalkanCrypt_С СДК НУЦ) в системном каталоге, в соответствии с разрядностью библиотеки. Имя размещаемой библиотеки должно содержать постфикс разрядности: KalkanCrypt64.dll — для 64-разрядной библиотеки, KalkanCrypt32.dll – для 32 разрядной.
2. Например, в 64-разрядной ОС Windows:  
     Библиотеку KalkanCrypt64.dll необходимо разместить в каталоге Windows\System32;  
     Библиотеку KalkanCrypt32.dll необходимо разместить в каталоге Windows\SysWOW64.
3. Установить в операционной системе корневые сертификаты НУЦ РК.  
    Сертификаты можно получить на портале НУЦ РК https://pki.gov.kz/cert/.  
    В случае, если в учетной системе криптографические операции выполняются на сервере, то указанные действия необходимо выполнить на сервере. Если криптографические операции выполняются на компьютере пользователя, то указанные действия выполняются в операционной системе каждого пользователя.  
    Компонента для работы со средствами криптографии НУЦ РК должна быть обновлена до версии 5.25. На текущий момент внешняя компонента, в том числе и при работе на стороне сервера, поддерживается только в операционных системах семейства Windows (начиная с версии Windows 7).

![](/Media/Pictures/KalkanCrypt/image.png)

Для подключения новой настройки необходимо, чтобы была установлена внешняя компонента для работы со средствами криптографии НУЦ РК. Установка выполняется автоматически при первом обращении.

Проверить установку и подключение компоненты можно в разделе Администрирование – Общие настройки — Настройка обмена электронными счетами фактурами (вкладка Криптографическая библиотека).

![](/Media/Pictures/KalkanCrypt/image-1.png)

В зависимости от настроек использования компоненты при включенном использовании криптографии KalkanCrypt от пользователя может потребоваться выбор ключей ЭЦП для аутентификации и ключей ЭЦП для подписи. Выбор ключа аутентификации необходим при включенной настройке Использовать открытие сессии с подписью во всех операциях требующих открытие сессии ИС ЭСФ, так как в этом  
случае используется новый метод аутентификации ИС ЭСФ.

![](/Media/Pictures/KalkanCrypt/image-2.png)

Если включена настройка Использовать криптографию НУЦ РК для подписи документов, то при отправке документов и других действиях системы ИС ЭСФ, требующих подпись, пользователю необходимо выбрать ключ для подписи.

![](/Media/Pictures/KalkanCrypt/image-3.png)

Если включены обе настройки использования сессии с подписью и использования криптографии НУЦ РК для подписи документов, то в случаях, где требуется подпись документов или других действиях системы ИС ЭСФ, необходимо выбрать оба ключа (аутентификации и подписи).

![](/Media/Pictures/KalkanCrypt/image-4.png)

Варианты использования новой настройки Использовать внешнюю криптографию (Kalkan) для компоненты при отправке документов:  
 включены настройки: Использовать открытие сессии с подписью и Использовать криптографию НУЦ РК для подписи документов;  
 выбрана настройка Использовать открытие сессии с подписью;  
В обоих случаях, при выполнении операций с электронными документами средствами 1С для пользователя будет выводиться общее окно Установка параметров ЭСФ, в котором необходимо выбрать ключ подписи документа и ключ аутентификации и ввести пароли от ключей, а также есть возможность сохранить использование этих ключей на время сеанса.

![](/Media/Pictures/KalkanCrypt/image-5.png)

Если выбрана настройка Использовать криптографию НУЦ РК для подписи документов одновременно с новой настройкой. В этом случае, в открывшемся окне Установка параметров ЭСФ, пользователю необходимо выбрать сертификат подписи и ввести пароль, с возможностью сохранения на время сеанса.

![](/Media/Pictures/KalkanCrypt/image-6.png)

Внимание! При работе с компонентой, использующей средства криптографии НУЦ РК необходимо учитывать, что ключ должен принадлежать пользователю, ИИН которого указан в профиле пользователя ИС ЭСФ.