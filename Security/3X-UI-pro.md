[Оригинальная статья](https://scarce-hole-1e2.notion.site/3X-UI-pro-with-REALITY-panel-and-inbounds-on-port-443-10d1666462e48085be0fee4c136ce417)
```table-of-contents
title: 
style: nestedList # TOC style (nestedList|nestedOrderedList|inlineFirstLevel)
minLevel: 0 # Include headings from the specified level
maxLevel: 0 # Include headings up to the specified level
includeLinks: true # Make headings clickable
debugInConsole: false # Print debug info in Obsidian console
```
# 3X-UI-pro with REALITY (panel and inbounds on port 443)

В прошлый раз, [вот тут](https://www.notion.so/1081666462e48069b35edf17d22894dc?pvs=21), я рассказывал как установить и настроить 3x-ui с обвязкой что бы все работало на порту 443, еще и с фейковым сайтом вместе. После этого я решил немного модернизировать этот скрипт, что бы поддерживались не только Trojan и Vless поверх вебсокетов но еще и REALITY с доменом маскировки на вашем же сервере

**!!!Если ваш хостер поставляет виртуалки с QEMU Virtual CPU, попросите изменить его на модель хоста, т.к. как показала практика с дефолтным CPU это не работает, я запостил багу в nginx а так же нашел тред 12 летней давности где разработчики пишут что они не хотят и не будут поддерживать виртуальные CPU!!!**

### Что новый скрипт делает

1. Устанавливает 3x-ui или x-ui
2. Устанавливает и настраивает nginx для реверспроксирования не только самой панели но и инбаундов vless/trojan c странспортами WebSocket/GRPC/HttpUgrade/SplitHttp а так же инбаунда vless с транспортом REALITY
3. Получает и настраивает SSL сертификаты для доменов или сабдоменов
4. Устанавливает фейковый сайт

### Зачем это нужно

1. Не нужно подбирать SNI для маскировки, маскируетесь под свои домены/поддомены
2. Все работает на одном порту, как панель, так и подключения
3. Отличная защита от пробберов, а они к сожалению уже гуляют, случаи что люди палили так или иначе свой сервер и там оставались рабочими только порты 22, 80 и 443
4. Ну и самый главный плюс, сайт под который вы маскируетесь находится на вашем же сервере, а это довольно важно для производительности связки vless+REALITY, ну и плюсом с данной настройкой ваше впн подключение для всех пробберов выглядит как работа с сайтом который расположен на том же сервере. Ваще ни к чем ни прикопаться.

### Что понадобится

1. Чистый сервер с ОС Debian или Ubuntu
2. **2 (ДВА)** Домена или саб-домена для сервера, обязательно, должены работать до начала установки Два бесплатных сабдомена можно получить у [duckdns.org](http://duckdns.org) но на момент написания всего этого у них были какие-то проблемы с резолвом( завтра может все полечат. Либо еще где-нибудь, либо если у вас есть виртуалка у [veesp](https://secure.veesp.com/?affid=860) и сабдомен к ней привязанный в зоне [isgood.host](http://isgood.host) то можно написать в каменты к этой статье и я выделю дополнительный. Но только через каменты и будет не прям сразу.

> Cloudflare не поддерживает проброс REALITY, поэтому если ваш домен скрыт cloudflare для корректной работы вам понадобится два сабдомена без проксирования. Для работы через Cloudflare подойдет только оригинальный скрипт. Следуйте либо [моей инстуркции](https://www.notion.so/1081666462e48069b35edf17d22894dc?pvs=21) либо [инструкции автора скрипта на гитхабе](https://github.com/GFW4Fun/x-ui-pro)

### Установка

1. Коннектимся к серверу по ssh
2. Запускаем команду

```jsx
sudo su -c "bash <(wget -qO- <https://raw.githubusercontent.com/mozaroc/x-ui-pro/refs/heads/master/x-ui-pro.sh>) -install yes -panel 1 -ONLY_CF_IP_ALLOW no"
```

Если ключ -panel указать 0, то будет установлена панель x-ui, я ставил 3x-ui

1. Скрипт попросит указать ваши домены, сначала для панели, затем для реалити, указываем, ждем заверешения
2. По окончанию работы скрипт выдаст три ссылки на вход, две на http - по IPv4 и по IPv6 и одну по https по домену, а так же логин и пароль, сохраняем все это.
3. Далее заходим на ссылку панели, авторизуемся, идем в настройки панели и меняем адрес прослушивания на 127.0.0.1 - что бы панель не светила ни одним портом в свет на голом http

![](/Media/Pictures/3X-UI-Pro/image1.webp)

1. Далее идем в подключения и создаем новый с типом vless транспортом tcp и безопасностью REALITY

![](/Media/Pictures/3X-UI-Pro/image2.webp)

Вот тут внимательно, указываем порт обязательно 8443, ни какой другой, nginx все запросы со SNI домена который вы указали как для reality будет перенаправлять только на этот порт

![](/Media/Pictures/3X-UI-Pro/image3.webp)

Включаем Proxy Protocol - это нужно для того что бы заработали лимиты по IP адресам если в будущем вы захотите их настроить. Конфиги nginx уже подготовлены для этого, поэтому он нужен, без него подключение не заработает

![](/Media/Pictures/3X-UI-Pro/image4.webp)

Включаем внешний прокси, домен указываем тот что используем для панели, порт **443**

В поле Dest указываем домен под который маскируемся, и порт **9443**, на этом порту по этому доменному имени слушает nginx и показывает фейковый сайт. В поле SNI указываем домен под который маскируемся

Не забываем сгенерировать сертификаты, сохраняем подключение, и можно зайти на домен под который маскируемся браузером и увидеть сайт заглушку, который так же покажется если зайти в чистом виде на домен панели.

Добавляем конфигурацию в клиента, пробуем, убеждаемся что все хорошо

Если не все хорошо, проверяем настройки, особенно что везде указали правильные порты, для протокола **8443** а в поле Dest **9443** . Проверяем импортированные настройки на клиенте, сервер должен быть указан доменом, порт **443.** Настраиваем все заново, думаем, в общем ДЕБАГ

Далее хорошо бы настроить firewall на сервере, для этого возвращаемся в SSH и даем следующие команды

```bash
apt update && apt install ufw
ufw reset && ufw allow ssh && ufw allow http && ufw allow https
ufw enable && ufw reload && ufw status
```

_**!!! Если вы переносили ssh на другой порт, вместо ufw allow ssh сделайте ufw allow ВАШ_ПОРТ/tcp !!!**_

Как настроить vless и trojan на вебсокетах и grpc вот с этим же скриптом я рассказывал [здесь](https://scarce-hole-1e2.notion.site/X-UI-pro-script-1081666462e48069b35edf17d22894dc)

### Подписка

Подписку просто включаете, **ключи прописывать не нужно,** можно по желанию сменить порт. Далее мотаете вниз до URI обратного прокси, в него прописываете https://ваш_домен/порт_подписки/sub/ и собственно все, сохраняем, перезапускаем панель, проверяем работу подписок.

### Клиенты и их ядра

Опытным путем было выяснено что клиенты работающие поверх ядра sing-box работают не со всеми типами подключений, например Trojan via grpc, у меня не до конца получилось разобраться почему так, но сам факт, если вам нужен этот тип подключения просто выбирите клиент на базе xray

[Инструкция по настройке IP Limit](https://www.notion.so/IP-Limit-3X-ui-11b1666462e480eca20fc412c685b071?pvs=21)

##############################################################

Ссылка для покупки VPS [https://secure.veesp.com/?affid=860](https://secure.veesp.com/?affid=860)

Ну и каменты и все прочее конечно приветствуется в телеге [https://t.me/crazy_day_admin](https://t.me/crazy_day_admin)

А т.к. каменты стали жить отдельной жизнью, я завел отдельный чат, велкам [https://t.me/crazyops_chat](https://t.me/crazyops_chat)