# üîó SSH-—Ç—É–Ω–Ω–µ–ª—å –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç 80

–≠—Ç–æ—Ç –º–∞–Ω—É–∞–ª –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–ø–æ—Å–æ–±–æ–≤ –ø—Ä–æ–±—Ä–æ—Å–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –ø–æ—Ä—Ç **80** –Ω–∞ —É–¥–∞–ª—ë–Ω–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ SSH.  
–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥ –Ω—É–∂–µ–Ω, –µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –±—Ä–∞—É–∑–µ—Ä –æ–∂–∏–¥–∞—é—Ç –¥–æ—Å—Ç—É–ø –∏–º–µ–Ω–Ω–æ –ø–æ –ø–æ—Ä—Ç—É 80 (–∞ –Ω–µ 8080).

---

## üìå –í–∞—Ä–∏–∞–Ω—Ç 1. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ `sudo`

–°–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± ‚Äî –∑–∞–ø—É—Å–∫–∞—Ç—å SSH —Å –ø—Ä–∞–≤–∞–º–∏ root:

```bash
sudo ssh -L 80:192.168.1.1:80 sarkin@100.100.222.49
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ `http://localhost/` –∏–ª–∏ `http://127.0.0.1/` –∑–∞–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –Ω–∞ `192.168.1.1:80` —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–µ—Ä `100.100.222.49`.

‚ö†Ô∏è –ú–∏–Ω—É—Å: –∫–∞–∂–¥—ã–π —Ä–∞–∑ –Ω—É–∂–µ–Ω –ø–∞—Ä–æ–ª—å `sudo`.

---

## üìå –í–∞—Ä–∏–∞–Ω—Ç 2. –†–∞–∑—Ä–µ—à–∏—Ç—å `ssh` —Ä–∞–±–æ—Ç–∞—Ç—å —Å –ø–æ—Ä—Ç–æ–º 80 –±–µ–∑ `sudo`

Linux –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∑–∞–ø—Ä–µ—â–∞–µ—Ç –æ–±—ã—á–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º —Å–ª—É—à–∞—Ç—å –ø–æ—Ä—Ç—ã `<1024`.  
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –º–æ–∂–Ω–æ —Å–Ω—è—Ç—å —á–µ—Ä–µ–∑ **capabilities**.

1. –†–∞–∑—Ä–µ—à–∞–µ–º –±–∏–Ω–∞—Ä–Ω–∏–∫—É `ssh` –¥–æ—Å—Ç—É–ø –∫ –Ω–∏–∑–∫–∏–º –ø–æ—Ä—Ç–∞–º:

```bash
sudo setcap 'cap_net_bind_service=+ep' $(which ssh)
```

2. –ü—Ä–æ–≤–µ—Ä—è–µ–º:

```bash
getcap $(which ssh)
```

   –î–æ–ª–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:

```bash
/usr/bin/ssh = cap_net_bind_service+ep
```

3. –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å —Ç—É–Ω–Ω–µ–ª—å **–±–µ–∑ sudo**:

```bash
ssh -L 80:192.168.1.1:80 sarkin@100.100.222.49
```

---

## üìå –í–∞—Ä–∏–∞–Ω—Ç 3. –ü—Ä–æ–±—Ä–æ—Å –Ω–∞ 8080 + iptables

–ï—Å–ª–∏ –Ω–µ —Ö–æ—á–µ—à—å –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ `ssh`, –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—Ä–æ–±—Ä–æ—Å –Ω–∞ 8080 –∏ –ª–æ–∫–∞–ª—å–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ —Å 80 ‚Üí 8080.

1. –ü–æ–¥–Ω–∏–º–∞–µ–º —Ç—É–Ω–Ω–µ–ª—å:

```bash
ssh -L 8080:192.168.1.1:80 sarkin@100.100.222.49
```

2. –î–æ–±–∞–≤–ª—è–µ–º –ø—Ä–∞–≤–∏–ª–∞ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è:

```bash
sudo iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-ports 8080
sudo iptables -t nat -A OUTPUT -p tcp --dport 80 -j REDIRECT --to-ports 8080
```

3. –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–±–æ—Ç—É:

    curl -v http://localhost/

   –û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å `192.168.1.1`.

üëâ –ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏:
- Debian/Ubuntu: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å `iptables-persistent`
- —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ: `iptables-save > /etc/iptables.rules` –∏ –∑–∞–≥—Ä—É–∂–∞—Ç—å —á–µ—Ä–µ–∑ `iptables-restore`

---

## üìå –í–∞—Ä–∏–∞–Ω—Ç 4. –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ systemd

–ß—Ç–æ–±—ã —Ç—É–Ω–Ω–µ–ª—å –ø–æ–¥–Ω–∏–º–∞–ª—Å—è —Å–∞–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã, —Å–æ–∑–¥–∞—ë–º unit-—Ñ–∞–π–ª `/etc/systemd/system/ssh-tunnel.service` —Å–æ —Å–ª–µ–¥—É—é—â–∏–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º:

```ini
[Unit]
Description=SSH Tunnel to 192.168.1.1:80
After=network.target

[Service]
ExecStart=/usr/bin/ssh -N -L 80:192.168.1.1:80 sarkin@100.100.222.49
Restart=always
User=your_user

[Install]
WantedBy=multi-user.target
```

–ê–∫—Ç–∏–≤–∏—Ä—É–µ–º:

```bash
sudo systemctl daemon-reload
sudo systemctl enable --now ssh-tunnel
```

> –ó–∞–º–µ–Ω–∏—Ç–µ `your_user` –Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –æ—Ç –∏–º–µ–Ω–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ —Ö–æ—Ç–∏—Ç–µ –∑–∞–ø—É—Å–∫–∞—Ç—å —Å–µ—Ä–≤–∏—Å.  
> –ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –∫–ª—é—á–∏ SSH –±–µ–∑ –ø–∞—Ä–æ–ª—è ‚Äî –ø–æ–º–µ—Å—Ç–∏—Ç–µ –∫–ª—é—á –≤ `~/.ssh/` –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ `ssh`-–∞–≥–µ–Ω—Ç –∏–ª–∏ `IdentityFile` –≤ `~/.ssh/config`.

---

## ‚úÖ –ß—Ç–æ –≤—ã–±—Ä–∞—Ç—å

- –ù—É–∂–Ω–æ –±—ã—Å—Ç—Ä–æ –∏ –ø—Ä–æ—Å—Ç–æ ‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 1 (sudo)**  
- –•–æ—á–µ—à—å –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏ –∑–∞–±—ã—Ç—å ‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 2 (setcap)**  
- –ï—Å–ª–∏ –Ω–µ–ª—å–∑—è –º–µ–Ω—è—Ç—å –±–∏–Ω–∞—Ä–Ω–∏–∫ `ssh` ‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 3 (iptables)**  
- –î–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ —Ç—É–Ω–Ω–µ–ª—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã ‚Üí **–í–∞—Ä–∏–∞–Ω—Ç 4 (systemd)**

---

## –î–æ–ø. —Å–æ–≤–µ—Ç—ã –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ö–æ–º–∞–Ω–¥–∞ `setcap` –º–µ–Ω—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –±–∏–Ω–∞—Ä–Ω–∏–∫–∞: —É–±–µ–¥–∏—Å—å, —á—Ç–æ —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ –≤ –≤–∞—à–µ–π —Å—Ä–µ–¥–µ. –ü—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ `openssh` capability –º–æ–∂–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å—Å—è ‚Äî –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ `setcap` –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, –µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è.  
- –î–ª—è systemd-—Å–µ—Ä–≤–∏—Å–∞ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SSH-–∫–ª—é—á–∏ –±–µ–∑ –ø–∞—Ä–æ–ª—è –∏–ª–∏ `ssh-agent`/`keychain`, —á—Ç–æ–±—ã —Å–µ—Ä–≤–∏—Å –Ω–µ –∑–∞–≤–∏—Å–µ–ª –æ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–≥–æ –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è.  
- –ï—Å–ª–∏ —É –≤–∞—Å –≤–∫–ª—é—á—ë–Ω firewall (ufw/firewalld), —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—Ä–∞–≤–∏–ª–∞ NAT/OUTPUT –Ω–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—É—é—Ç —Å –Ω–∏–º.  
- –î–ª—è —Ç–µ—Å—Ç–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `curl -v http://localhost/` –∏ —Å–º–æ—Ç—Ä–∏—Ç–µ –∏—Å—Ö–æ–¥—è—â–∏–π IP/–∑–∞–≥–æ–ª–æ–≤–∫–∏, —á—Ç–æ–±—ã —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ç—Ä–∞—Ñ–∏–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ —Ç—É–Ω–Ω–µ–ª—å.

