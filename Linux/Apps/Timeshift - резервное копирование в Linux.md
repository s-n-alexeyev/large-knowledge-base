2022-12-29

[Оригинальная статья: Автор - Hirusha Adikari](https://medium.com/@hirushaadi/a-comprehensive-guide-to-using-timeshift-for-backups-on-linux-897b7cdf55fc?responsesOpen=true&sortBy=REVERSE_CHRON) 
```table-of-contents
title: Содержание:
style: nestedList # TOC style (nestedList|inlineFirstLevel)
minLevel: 0 # Include headings from the specified level
maxLevel: 0 # Include headings up to the specified level
includeLinks: true # Make headings clickable
debugInConsole: false # Print debug info in Obsidian console
```

Если вы пользователь Linux, вы знаете, как важно регулярно создавать резервные копии вашей системы для защиты от потери данных и сбоев системы. Хотя для Linux доступно множество решений для резервного копирования, Timeshift выделяется как надежный и удобный вариант. В этом руководстве мы расскажем вам все, что вам нужно знать об использовании Timeshift для управления резервными копиями в вашей системе Linux, в том числе о том, как его установить и настроить, создавать и восстанавливать резервные копии, а также устранять распространенные проблемы. Независимо от того, являетесь ли вы новичком или опытным пользователем Linux, это руководство предоставит вам инструменты и знания, необходимые для эффективного управления резервными копиями с помощью Timeshift.

## Введение

Timeshift — бесплатная утилита с открытым исходным кодом для создания и управления резервными копиями системы в системах Linux. Это позволяет пользователям делать снимки своей системы в определенный момент времени и при необходимости легко восстанавливать систему до этого состояния. Timeshift использует технологию моментальных снимков rsync и BTRFS для создания эффективных и простых в управлении резервных копий. Он доступен для широкого спектра дистрибутивов Linux, включая Ubuntu, Linux Mint и Fedora.
## Установка

Чтобы установить Timeshift в вашей системе Linux, вам необходимо добавить репозиторий Timeshift в менеджер пакетов вашей системы. Точные шаги для этого будут различаться в зависимости от вашего дистрибутива Linux. Например, в Ubuntu и Linux Mint вы можете использовать следующую команду для добавления репозитория Timeshift:

>DEB
```shell
sudo add-apt-repository -y ppa:teeejee2008/ppa
```

>После добавления репозитория вы можете использовать следующую команду для установки Timeshift:
```shell
sudo apt-get update  
sudo apt-get install timeshift
```

>ARCH
```shell
sudo pacman -S timeshift
```

В других дистрибутивах вам может потребоваться использовать другой менеджер пакетов или метод установки. Подробные инструкции см. в документации Timeshift.
## Настройка

>После установки Timeshift вам необходимо будет настроить его, прежде чем вы сможете начать создавать резервные копии. Для этого используйте следующую команду для запуска Timeshift:
```shell
timeshift
```

При первом запуске Timeshift вам будет предложено выбрать утилиту создания снимков. На выбор есть три варианта: rsync, rsync+ssh и BTRFS.

- Rsync — это быстрый и эффективный инструмент для создания резервных копий, но он требует, чтобы исходное и целевое расположение находились в одной системе.
- Rsync+ssh позволяет создавать резервные копии через сетевое соединение, но требует, чтобы в целевой системе был настроен ssh-сервер.
- BTRFS — это усовершенствованная файловая система со встроенными возможностями создания снимков. Он доступен только в системах, использующих файловую систему BTRFS.

После выбора утилиты создания снимков вам нужно будет выбрать место назначения для резервных копий. Timeshift поддерживает широкий спектр типов мест назначения, включая локальные диски, общие сетевые ресурсы и поставщиков облачных хранилищ, таких как Amazon S3 и Google Cloud Storage.
## Создание резервных копий

После настройки Timeshift вы можете начать создавать резервные копии вашей системы. Чтобы создать резервную копию, запустите Timeshift и нажмите кнопку «Создать». Вам будет предложено выбрать тип снимка: системный, домашний или пользовательский.  
Снимки системы включают все системные файлы и каталоги, за исключением тех, которые исключены по умолчанию (например, временные файлы и каталоги кэша).  
Домашние снимки включают все пользовательские файлы и каталоги в домашнем каталоге.  
Пользовательские снимки позволяют выбирать определенные файлы и каталоги для включения в резервную копию.  
После выбора типа моментального снимка вы можете включить или исключить определенные каталоги или файлы из резервной копии. Вы также можете указать метку снимка, которая представляет собой определяемое пользователем имя снимка. Это может быть полезно для идентификации и организации резервных копий.  
После настройки моментального снимка нажмите кнопку «Создать», чтобы начать процесс резервного копирования. Процесс резервного копирования может занять некоторое время, в зависимости от размера вашей системы и скорости вашего устройства хранения данных. За ходом резервного копирования можно следить в окне Timeshift.

>Чтобы создать резервную копию с помощью интерфейса командной строки Timeshift, используйте следующую команду:
```shell
timeshift --create
```

При этом будет создан полный снимок системы, включая все системные файлы и каталоги, за исключением исключенных по умолчанию (например, временных файлов и каталогов кэша).

Вы также можете использовать следующие параметры для создания снимка другого типа:  
- `--home`: создать снимок, включающий все пользовательские файлы и каталоги в домашнем каталоге.
- `--custom`: Создайте снимок, который позволит вам выбрать определенные файлы и каталоги для включения в резервную копию.

Вы также можете указать метку снимка с помощью этой `--label` опции, которая представляет собой определяемое пользователем имя снимка. Это может быть полезно для идентификации и организации резервных копий.

>Например, чтобы создать собственный снимок вашего домашнего каталога с меткой «home_backup», вы можете использовать следующую команду:
```shell
timeshift --custom --home --label home_backup
```
## Восстановление резервных копий

>Чтобы просмотреть список доступных резервных копий, используйте следующую команду:
```shell
timeshift --list
```

Появится список всех доступных резервных копий с их метками, датой и временем их создания.

Если вам нужно восстановить систему из резервной копии, вы можете использовать Timeshift, чтобы легко вернуться к предыдущему состоянию. Чтобы восстановить резервную копию, запустите Timeshift и выберите из списка снимок, который хотите восстановить. Нажмите кнопку «Восстановить», чтобы начать процесс восстановления.

>Чтобы восстановить резервную копию с помощью интерфейса командной строки Timeshift, используйте следующую команду:
```shell
timeshift --restore
```

Процесс восстановления и предложит вам выбрать резервную копию из списка доступных снимков. Вы также можете использовать `--latest` опцию восстановления самой последней резервной копии или `--id` опцию указания конкретной резервной копии по идентификатору.

>Например, чтобы восстановить самую последнюю резервную копию, вы можете использовать следующую команду:
```shell
timeshift --restore --latest
```

В процессе восстановления вам будет предложено подтвердить операцию восстановления и выбрать дополнительные параметры. Например, вы можете выбрать восстановление только системных файлов или только пользовательских файлов или перезаписать существующую систему резервной копией.  
Важно отметить, что восстановление снимка перезапишет все изменения, внесенные в вашу систему с момента создания снимка. Обязательно соблюдайте осторожность при восстановлении резервных копий и рассмотрите возможность создания нового моментального снимка перед восстановлением, если вы хотите сохранить копию текущего состояния системы.
## Планирование резервного копирования

Timeshift позволяет вам планировать автоматическое резервное копирование вашей системы через регулярные промежутки времени. Чтобы запланировать резервное копирование, запустите Timeshift и нажмите кнопку «Запланировать». Вам будет предложено выбрать тип и место назначения моментального снимка, а также указать интервал и время резервного копирования.  
Чтобы запланировать автоматическое резервное копирование с помощью интерфейса командной строки Timeshift, вы можете использовать эту `--schedule` опцию. Это позволит вам указать интервал и время, в которое должно выполняться резервное копирование.

>Например, чтобы запланировать ежедневное резервное копирование на 3:00 ночи, вы можете использовать следующую команду:
```shell
timeshift --schedule daily 3:00
```

Timeshift поддерживает различные варианты планирования, включая ежедневное, еженедельное и ежемесячное резервное копирование. Вы также можете указать количество сохраняемых снимков, которое определяет, сколько резервных копий будет сохранено до того, как самые старые из них будут удалены.

>Чтобы отменить запланированное резервное копирование с помощью Timeshift, используйте следующую команду:
```shell
timeshift --cancel
```

Отмена всех запланированных резервных копий и удаление их из расписания.

>Чтобы просмотреть запланированное резервное копирование с помощью Timeshift, используйте следующую команду:
```shell
timeshift --list-scheduled
```

Отобразится список всех запланированных резервных копий с указанием их интервала и следующего запланированного времени.
## Поиск неисправностей

Если при использовании Timeshift у вас возникнут какие-либо проблемы, вы можете попробовать несколько распространенных решений.  
Убедитесь, что в месте назначения резервного копирования имеется достаточно места на диске. Timeshift не сможет создавать резервные копии, если для их хранения недостаточно места.  
Проверьте журналы Timeshift на наличие сообщений об ошибках или проблем, которые могли возникнуть в процессе резервного копирования. Вы можете получить доступ к журналам, нажав кнопку «Журналы» в окне Timeshift.

>Чтобы просмотреть журналы Timeshift, используйте следующую команду:
```shell
timeshift --log
```

Будет отображен список всех последних операций резервного копирования и восстановления, а также любые ошибки или проблемы, которые могли возникнуть. Журналы могут быть полезны при устранении проблем с Timeshift.

Если вы используете rsync или rsync+ssh в качестве утилиты создания снимков, убедитесь, что демон rsync запущен в целевой системе.  
Если вы используете сетевой ресурс или поставщика облачного хранилища в качестве места назначения резервного копирования, убедитесь, что вы правильно настроили соединение с местом назначения.  
Timeshift — мощный и удобный инструмент для создания резервных копий и управления ими в системах Linux. Следуя инструкциям, описанным в этом руководстве, и используя предоставленные команды терминала, вы можете эффективно использовать Timeshift для защиты вашей системы от потери данных и сбоев системы. Независимо от того, являетесь ли вы новичком или опытным пользователем Linux, Timeshift предлагает надежное и гибкое решение для управления резервными копиями. Обязательно регулярно создавайте и проверяйте резервные копии, чтобы гарантировать, что ваши данные защищены и доступны, когда они вам понадобятся.