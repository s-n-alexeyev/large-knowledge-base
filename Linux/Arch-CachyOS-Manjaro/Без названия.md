## **Полное решение проблемы "Path not allowed"**

### 1. **Остановим Samba и очистим всё**

bash

# Остановим службы
sudo systemctl stop smb nmb

# Удалим ВСЕ старые файлы шаров
sudo rm -rf /var/lib/samba/usershares/*

# Убедимся, что директория существует с правильными правами
sudo mkdir -p /var/lib/samba/usershares
sudo chown root:sambashare /var/lib/samba/usershares
sudo chmod 1770 /var/lib/samba/usershares

### 2. **Упростим конфигурацию Samba до минимума**

bash

sudo nano /etc/samba/smb.conf

**ЗАМЕНИТЕ ВЕСЬ ФАЙЛ на это:**

ini

[global]
    workgroup = WORKGROUP
    server string = Samba Server
    security = user
    map to guest = bad user
    
    # Usershare settings - БЕЗ ОГРАНИЧЕНИЙ
    usershare allow guests = yes
    usershare max shares = 100
    usershare owner only = no
    usershare path = /var/lib/samba/usershares

### 3. **Проверим путь к папке Games**

bash

# Узнаем точный путь
echo "Домашняя директория: $HOME"
echo "Путь к Games: $(readlink -f ~/Games)"

# Проверим права на папку Games
ls -ld ~/Games

### 4. **Создадим тестовую папку в домашней директории**

bash

# Создадим простую тестовую папку
mkdir -p ~/test-share
echo "Это тестовая папка" > ~/test-share/test.txt

### 5. **Запустим Samba и проверим**

bash

sudo systemctl start smb nmb
sudo systemctl status smb nmb

# Проверим usershares
net usershare list

### 6. **Создадим шар ВРУЧНУЮ через терминал**

bash

# Попробуем создать шар вручную для тестовой папки
net usershare add test-share ~/test-share "Test Share" guest:rw

# Проверим
net usershare list --long

### 7. **Если ручное создание работает, попробуем для Games**

bash

# Удалим старый проблемный файл если есть
sudo rm -f /var/lib/samba/usershares/games
sudo rm -f /var/lib/samba/usershares/Games

# Создадим шар для Games вручную
net usershare add Games ~/Games "Games Share" guest:rw

# Проверим
net usershare list --long

### 8. **Если ВСЁ ЕЩЁ не работает - диагностика**

bash

# Проверим логи в реальном времени
sudo tail -f /var/log/samba/log.smbd &

# Пробуем создать шар
net usershare add test ~/test-share "Test" guest:rw

# Смотрим какие ошибки в логах

### 9. **Альтернативное решение - используем классические shares**

Если usershares упорно не работают, настроим классический шар:

bash

sudo nano /etc/samba/smb.conf

**Добавьте в конец файла:**

ini

[Games]
    path = /home/ваш_пользователь/Games
    browsable = yes
    writable = yes
    guest ok = yes
    read only = no

**Замените `ваш_пользователь` на ваше имя пользователя!**

bash

# Перезапустим Samba
sudo systemctl restart smb nmb

# Проверим
smbclient -L localhost

### 10. **Проверка через Dolphin**

Теперь откройте Dolphin и в адресной строке введите:

text

smb://localhost/

Вы должны увидеть расшаренную папку Games.

### 11. **Если всё равно не работает - ядерное решение**

bash

# Полная переустановка Samba
sudo pacman -Rns samba
sudo rm -rf /etc/samba /var/lib/samba

# Установка заново
sudo pacman -S samba

# Базовая настройка
sudo cp /etc/samba/smb.conf.default /etc/samba/smb.conf

# Добавим в конфиг минимум настроек
echo -e "\n\nusershare allow guests = yes\nusershare path = /var/lib/samba/usershares" | sudo tee -a /etc/samba/smb.conf

# Создадим структуру
sudo mkdir -p /var/lib/samba/usershares
sudo chown root:sambashare /var/lib/samba/usershares
sudo chmod 1770 /var/lib/samba/usershares

# Запустим
sudo systemctl enable --now smb nmb

## **После успешной настройки**

Если ручное создание шаров через `net usershare` работает, но Dolphin все равно выдает ошибку:

1. **Полностью закройте Dolphin**
    
    bash
    

killall dolphin

**Перезапустите KDE службы**

bash

kbuildsycoca5

1. **Запустите Dolphin заново и попробуйте**
    

## **Проверка результата**

После всех манипуляций выполните:

bash

net usershare list --long

Если видите свою расшаренную папку без ошибок - проблема решена.

**Пожалуйста, сообщите:**

1. Что показывает `net usershare list --long` после ручного создания шаров
    
2. Результат `testparm`
    
3. Любые ошибки в логах Samba
    

Это поможет точно диагностировать проблему, если она останется.