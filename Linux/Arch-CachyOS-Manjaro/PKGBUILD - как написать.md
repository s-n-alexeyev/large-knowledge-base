В связи со стремительным набором популярности я заметил, что на Manjaro стремительно стали пробовать переходить убунтоводы, минтовцы и прочие дебианщики. Очень часто наблюдаю комментарии, что в Manjaro `apt-get` не работает или рекомендации установить deb-пакет при помощи `dpkg`. Такие фразы периодически веселят, но когда это происходит практически каждый день в телеграмм-чате я все-таки решился написать маленький how-to как же все-таки написать PKGBUILD и установить приложение, которого нет в AUR. Писатель из меня никудышный, поэтому не стоит оценивать перо автора очень критично. И так приступим.
Для начала немного теории. PKGBUILD — это обычный текстовый файл с набором инструкций по сборке пакетов для арчеподобных дистрибутивов. На выходе мы должны получить пакет с расширением `*.pkg.tar.xz`. По сути это просто архив с установочными файлами пакетов и информацией об устанавливаемом пакете. с помощью PKGBUILD можно написать инструкцию по сборке пакета из `*.deb`, `*.rpm`, их исходников и даже просто из обычного архива файлов. Главное понимать что ты собираешься получить на выходе.
### Пример написания PKGBUILD для сборки из deb

для примера я возьму IPTV-player украинского разработчика Вячеслава Зубика [ZVVOnlineTV](http://zvvubuntu.blogspot.com/2016/06/zvvonlinetv.html), которого, кстати нет в AUR.  
Скачиваем deb-пакет с сайта и помещаем его в отдельный каталог(для удобства).  
рядом с файлом создаем текстовый файл и присваиваем ему имя PKGBUILD.
открываем его в текстовом редакторе.

>Итак. первая строка не обязательна и не несет какой-либо инструктивности, а просто говорит нам кто разработчик  
```q
# Maintainer: Вячеслав Зубик
```
  
>идем далее  
```q
pkgname=zvvonlinetv
```
  
имя пакета,  [здесь](https://wiki.archlinux.org/index.php/PKGBUILD_(Русский)#install) все подробно описано.  
>далее создадим типа «переменную» с именем ZVVOnlineTV  
```q
_pkgname=ZVVOnlineTV
```
  
>здесь скажу пару слов. Так как ОС линукс чувствительна к регистру, то нам нужно это дело как-то обозначить.  
следующее  
```q
pkgver=2.1
```
  
>присваиваем актуальную версию программы,  
```q
_pkgver=2_1
```

так как имя скачанного файла ZVVOnlineTV2_1.deb, то нужно создать еще одну переменную.

>присваиваем версию релиза.  
```q
pkgrel=1
```

>добавляем описание  
```q
pkgdesc="TV player"
```
  
>архитектуру.  
```q
arch=('i386' 'x86_64')
```

>и ссылку на источник.  
```q
url="https://zvvubuntu.blogspot.com"
```

>указываем лицензию, я не знаю под какой лицензией разработчик распространяет это приложение. поэтому custom  
далее определяем зависимости, которые необходимы для работы приложения, они есть на сайте разработчика  
```q
license=('custom')
```

Для запуска ТВ в системе должны быть установлены:  
1. Библиотеки **PyQt5** и **Gstreamer**

>сделали.  
```q
depends=('pyqt5-common' 'python-pyqt5' 'vlc' 'qt5-multimedia' 'gstreamer' 'gst-libav' 'gst-plugins-bad')
```

какие нужны зависимости, ищите в инструкциях разрабов или гуглением или посредством вылова ошибок при работе программы, — если вдруг начала ругаться, что не хватает какой-то библиотеки, значит это необходимая зависимость!!!)  

>Идем далее  
```q
source=("${_pkgname}${_pkgver}.deb")
```

здесь мы показываем источник, из которого мы будем брать данные(файлы программы) для сборки, вот как раз сдесь нам и пригодятся наши переменные ${\_name} — это имя пакета ZVVOnlineTV, а ${\_pkgver} — это его версия 2_1 использованная в имени файла, далее ставим точку и указываем расширение deb.  
в source можно указать и url-ссылку на исходный файл, если их несколько то они перечисляются в кавычках через пробел:  

>например!
```q
md5sums=('a16762ab1e46f401d4e26a4b6fd74898')
```

>здесь указывается контрольная сумма файла, подробнее в арчвики, если не знаете где ее взять, укажите в кавычках SKIP, вот так  
```q
md5sums=('SKIP')
```

>Далее переходим непосредственно к сборке.  
```q
package() {
  cd "${srcdir}"
  bsdtar -xf data.tar.xz -C "$pkgdir"
}
```
  
Когда начнется сборка, то в каталоге, где вы разместили файл ZVVOnlineTV2_1.deb и создали PKGBUILD будет создано две директории src и pkg. Так вот файл ZVVOnlineTV2_1.deb (это по сути архив) распакуется в директорию src и в ней будут лежать наши файлы data.tar.xz, control.tar.gz, debian-binary и прочее.  
Командой cd "${srcdir}" мы говорим скрипту что нужно переместиться именно в эту директорию для продолжения работы, вторая команда распаковывает архив data.tar.xz в директорию pkg. Дальше все это дело благополучно упакуется а архив с именем zvvonlinetv-2.1-1-x86_64.pkg.tar.xz.  
прочитав до этого момента вы должны спросить, а когда же все-таки начнется сборка, и я отвечу, что для сборки пакета нужно открыть терминал в каталоге с этими файлами и запустить команду  

```shell
makepkg
```
  
после того как скрипт отработает его можно установить командой  

```shell
sudo pacman -U package_name
```
  
где `package_name` имя вашего пакета, в данном случае zvvonlinetv-2.1-1-x86_64.pkg.tar.xz  

PKGBUILD
### Пример написания PKGBUILD для сборки из исходников

для примера я возьму выключалку компьютера [qshutdown](https://launchpad.net/~hakaishi/+archive/ubuntu/qshutdown), которой тоже нет в ауре  
Подробно описывать не буду, а опишу только некоторые отличия.  
В файле README описана инструкция по установке и необходимые зависимости для работы программы.  
итак отличие будет в том, что у нас будет 2 секции build(){} и package() {}  

```q
build() {
	cd "$srcdir/$pkgname-$pkgver"

	qmake 
	make -j4
	}

package() {
	cd "$srcdir/$pkgname-$pkgver"
	make INSTALL_ROOT="$pkgdir" install
}
```
  
Порядок выполнения команд такой же как описано в README файле, единственное на что нужно обратить внимание, так это на строку  

```
make INSTALL_ROOT="$pkgdir" install
```

в связи с тем что команду make install нужно выполнять от суперпользователя, в скрипте нужно это указать, чтобы во время сборки была создана имитация рут-установки.  
пример PKGBUILD'a  

Спойлер!

Напоследок несколько ключей для работы с `makepkg`  
`makepkg -i` — собирает и устанавливает пакет,  
`makepkg -s` — устанавливает зависимости и собирает пакет  
`makepkg -si` — собирает и устанавливает пакет
`makepkg -g `— выдает контрольную сумму пакетов.  
  
Про сборку из rpm-пакетов не буду вдаваться в подробности, единственное, что должен быть установлен rpmextract/pkgextract.  
#### пример для rpm
  
складываем необходимые пакеты rpm в один каталог и создаем PKGBUILD примерно такого содержания, в source указываем имена нужных [rpm-файлов](http://rep.sparkle.city/fedora/22/x86_64/)  

Спойлер!
Эта програма давно не поддерживается, PKGBUILD выложен просто как пример  
Остались вопросы пишите в комментариях  
Всем удачи, [арчвики](https://wiki.archlinux.org/index.php/PKGBUILD_(Русский)#install) в помощь!)

---

Памятка:

>создаем .SRCINFO
```bash
makepkg --printsrcinfo > .SRCINFO
```

>добавляем все необходимые файлы
```bash
git add PKGBUILD .SRCINFO
```

>коммитим
```bash
git commit -m "v1.2"
```

>загружаем в AUR
```bash
git push
```